{"version":3,"sources":["sw.js"],"names":["CACHE_VERSION","CACHE_NAME","preCache","caches","delete","then","cache","addAll","CACHE_URLS","self","addEventListener","evt","waitUntil","skipWaiting","keys","forEach","key","console","reqList","open","clients","length","client","log","matchAll","URL","request","clone","response","status","origin","respondWith","match","catch","fetch","headers","get","responseClone","put"],"mappings":"aACA,IAAIA,cAAgB,EAAhBA,WAAAA,UAAJA,cACIC,WAAa,CACjB,IAEE,eAWF,iBACA,mBACE,mBACE,kBACD,eACF,kBATC,qBAeI,SAAAC,WACEC,OAAAA,OAAOC,KAAPH,YAAAI,KAAA,SAAAC,GACD,OAAAA,EAAAC,OAAAC,cAKPC,SAAKC,aACHC,OAAIC,OAAUV,OAAAA,KAAWG,SAAUQ,GACnCC,EAAAC,QAAA,SAAAC,GAFFA,IAAAf,YANQE,OAAOC,OAAOY,OAgBpBL,KAAAA,iBACER,UAAYF,SAAYI,GACtBY,EAAAA,UAAYX,WAAZD,KAAAI,KAAAI,gBAIAJ,KAAAC,iBAAO,WAAkB,SAASQ,GAK5BD,EAAAA,UACAd,OAAAgB,KAAIC,YAAWA,KAAQC,SAAQf,GAG5B,OAFDc,QAAAA,IAAAA,GACEE,aADFhB,IAGDD,KAAA,SAAAC,GACF,OAPDA,EAAAQ,OAAAT,KAAA,SAAAa,GAQDD,QAAAM,IAAA,UAAAL,GAlBPA,EAAAG,QALFZ,KAAAW,QAAAI,WAAAnB,KAAA,SAAAe,GAgBYH,QAAQM,IAAI,SAAUH,GAa7BV,GAAiBU,EAASC,QAC7BD,EAAAL,QAAA,SAAAO,GACcG,EAAId,YAAR,wBAWNF,KAAAC,iBAAkBgB,QAAQC,SAA1BhB,GAEOiB,IAAAA,IAADjB,EAAaiB,QAASC,KACxBC,SAAOF,KAAPE,QAKDnB,EAAAoB,YACD5B,OAAA6B,MAAOJ,EAAPF,SAAArB,KAAA,SAAAuB,GARF,GAAAA,EAUCK,OAAML,EAhBX,IAAAF,EAAAf,EAAAe,QAAAC,QARF,OAAAO,MAAAR,GAAArB,KAAA,SAAAuB,GAeQ,IAAKA,GAAgC,MAApBA,EAASC,SAAmBD,EAASO,QAAQC,IAAI,gBAAgBJ,MAAM,UACtF,OAAOJ,EAET,IAAIS,EAAgBT,EAASD,QAI7B,OAHAxB,OAAOgB,KAAKlB,YAAYI,KAAK,SAASC,GACpCA,EAAMgC,IAAI3B,EAAIe,QAASW,KAElBT,MAERK,MAAM,WACP,OAAO9B,OAAO6B,MAAMrB,EAAIe","file":"sw.js","sourcesContent":["\nvar CACHE_VERSION = 1;\nvar CACHE_NAME = 'cache-v' + CACHE_VERSION;\nvar CACHE_URLS = [\n  '/',\n  '/js/index.js',\n  '/css/index.css',\n  '/img/BYJ2015.jpg',\n  '/img/BYJ2016.jpg',\n  '/img/nav-bg.jpg',\n  '/img/xc3.jpg',\n  '/img/xcpost.jpg',\n  '/img/xcpostPc.jpg',\n]\n\n\n/** 预缓存 */\nfunction preCache() {\n  return caches.open(CACHE_NAME).then(function(cache) {\n    return cache.addAll(CACHE_URLS);\n  })\n}\n\n/** 清楚缓存 */\nfunction clearCache() {\n  return caches.keys().then(function(keys) {\n    keys.forEach(function(key) {\n      if (key !== CACHE_NAME) {\n        caches.delete(key)\n      }\n    })\n  })\n}\n\nself.addEventListener('install', function(evt) {\n  evt.waitUntil(preCache().then(self.skipWaiting));\n  // evt.waitUntil(preCache());\n});\n\nself.addEventListener('activate', function(evt) {\n  // evt.waitUntil(Promise.all([\n  //   clearCache(),\n  //   self.clients.claim(),\n  // ]))\n  evt.waitUntil(\n    caches.open(CACHE_NAME).then(function(cache) {\n      console.log(cache)\n      clearCache()\n      return cache;\n    }).then(function (cache) {\n      return cache.keys().then(function(reqList) {\n        console.log('reqList', reqList)\n        // 如果原来 cache 没有内容，则代表第一次安装，不用提示用户\n        if (reqList.length) {\n          self.clients.matchAll().then(function (clients) {\n            console.log('client', clients)\n            if (clients && clients.length) {\n              clients.forEach(function(client) {\n                client.postMessage('sw.update')\n              });\n            }\n          })\n        }\n      })\n    })\n  )\n})\n\nself.addEventListener('fetch', function(evt) {\n  // 判断是否是同域名，如果不是同域名则不处理（cdn情况）\n  var url = new URL(evt.request.url)\n  if (url.origin !== self.origin) {\n    return\n  }\n\n  // 网络请求优先\n  evt.respondWith(\n    caches.match(evt.request).then(function(response) {\n      if (response) {\n        return response;\n      }\n      var request = evt.request.clone();\n      return fetch(request).then(function(response) {\n        if (!response && response.status !== 200 && !response.headers.get('Content-type').match(/imgage/)) {\n          return response;\n        }\n        var responseClone = response.clone();\n        caches.open(CACHE_NAME).then(function(cache) {\n          cache.put(evt.request, responseClone);\n        })\n        return response;\n      })\n    }).catch(function() {\n      return caches.match(evt.request)\n    })\n  )\n})"]}